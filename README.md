<div align="center">

# ğŸ’ Mr. Cleaner: Maya AI Concierge
### Visionary AI Agent Platform for Elite Mobile Detailing Enterprises

<br/>

[![Next.js](https://img.shields.io/badge/Next.js-14-000000?style=for-the-badge&logo=next.js&logoColor=white)](https://nextjs.org)
[![DeepSeek V3](https://img.shields.io/badge/DeepSeek_V3-Primary_Orchestrator-6366F1?style=for-the-badge)](https://deepseek.com)
[![Supabase](https://img.shields.io/badge/Supabase-Persistence-3ECF8E?style=for-the-badge&logo=supabase&logoColor=white)](https://supabase.com)
[![Google Calendar](https://img.shields.io/badge/Google_Calendar-Real--Time_Sync-4285F4?style=for-the-badge&logo=google-calendar&logoColor=white)](https://calendar.google.com)
[![Twilio](https://img.shields.io/badge/Twilio-Lead_Alerts-F22F46?style=for-the-badge&logo=twilio&logoColor=white)](https://twilio.com)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow?style=for-the-badge)](./LICENSE)

<br/>

> *"Maya doesn't just chat; she inspects, qualifies, and orchestrates your business intelligence."*

**Mr. Cleaner** is a premium, vision-capable AI Agent platform built for high-end automotive detailing businesses. Powered by **Maya (DeepSeek-V3)**, the system performs autonomous vehicle inspections via computer vision, manages intelligent lead qualification, and provides a cinematic "Owner Portal" for real-time ROI tracking.

[**âœ¨ Features**](#-key-features) Â· [**ğŸ—ï¸ Architecture**](#-architecture) Â· [**ğŸš€ Setup**](#-installation) Â· [**ğŸ›¡ï¸ Security**](#-security--scalability)

---

</div>

## ğŸ“Œ The Elite Detailing Problem

Traditional booking systems and generic chatbots fail luxury automotive brands:

- **Manual Vehicle Inspection**: Determining a quote currently requires a human to look at photos or the car in person.
- **Lead Drift**: High-intent customers get lost in email threads instead of being qualified instantly.
- **Calendar Conflict**: Scheduling is often a manual back-and-forth between owner and client.
- **Data Blindness**: Business owners don't see the "reasoning path" â€” why a customer did or didn't book.
- **Rigid Logic**: Changing a price usually requires a developer to update code.

**Mr. Cleaner handles all five.** Maya uses computer vision to inspect vehicle condition, qualifies leads in seconds, syncs directly with Google Calendar, and allows owners to update business knowledge via a simple Supabase dashboard.

---

## âœ¨ Key Features

### ğŸ‘ï¸ Maya Vision (Computer Vision Inspection)
Maya is configured for visual vehicle assessments (`lib/ai-agent.js`):
- **Body Identification**: Automatically detects if the vehicle is a Sedan, SUV, Truck, or Large SUV.
- **Surface Diagnostics**: Identifies scratches, swirl marks, mud, and oxidation from uploaded photos.
- **Intelligent Upselling**: Recommends "Ceramic Coating" or "Full Correction" based on visual evidence.
- **Visual Evidence Logging**: Stores the "State of Vehicle" in the reasoning trace for quality assurance.

### ğŸ§  Decoupled Orchestration Loop
The `app/api/chat/route.js` implements a sophisticated "ReAct" cycle:
1. **System Prompt Injection**: Loads the `MAYA_SYSTEM_PROMPT` containing elite concierge protocols.
2. **Autonomous Tooling**: Maya iteratively calls `get_availability`, `calculate_quote`, and `sync_booking_state` before replying.
3. **Max 5 Iterations**: Prevents infinite loops while allowing for complex, multi-tool reasoning chains.
4. **State Persistence**: Customer details (name, phone, vehicle) are synced to the session state automatically as they are mentioned.

### ğŸ“… Infinite Calendar Sync
Bi-directional integration with Google Calendar (`lib/calendar.js`):
- **Auth Token Drift Fix**: Automatically listens for refresh tokens and persists them to Supabase to prevent API disconnects.
- **Dynamic Slot Generation**: Checks "primary" calendar busy times and generates 60-minute interval windows between 8 AM and 6 PM.
- **Requested Duration Aware**: Adjusts slot availability based on the specific service duration (e.g., Ceramic Coating needs 8 hours).

### ğŸ›¡ï¸ Zod-Guarded Tool Execution
Every action Maya takes is validated against hard schemas in `lib/tools.js`:
- **Pricing Integrity**: The `calculate_quote` tool is strictly limited to the `FALLBACK_KNOWLEDGE` or Supabase business rules.
- **Phone Validation**: Uses `libphonenumber-js` to ensure only valid E.164 USA numbers are accepted.
- **Date Protection**: Prevents appointments for past dates or invalid string formats.

### ğŸ“Š Intelligence Dashboard (Owner Portal)
A secure Admin UI (`app/dashboard`) for business management:
- **Projected ROI Tracking**: Real-time stats on potential revenue generated by Maya.
- **Lead Conversion Funnel**: Visualizing the ratio of "Inquiring" vs "Qualified" vs "Confirmed" leads.
- **Live Reasoning Trace**: Watch Maya's internal logs and tool calls in real-time.
- **Business Knowledge Editor**: Update pricing and policies directly in the database without touching code.

---

## ğŸ—ï¸ Architecture

### Decoupled Orchestration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Client (Next.js 14)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Hero & Landing â”‚   â”‚ Chat Interface â”‚   â”‚ Admin Dash  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                     â”‚                   â”‚
          â–¼                     â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Next.js API Orchestrator                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Maya Logic Engine (app/api/chat)                     â”‚  â”‚
â”‚  â”‚  â€¢ Reasoning Loop (ReAct)                             â”‚  â”‚
â”‚  â”‚  â€¢ Tool Guarding (Zod)                                â”‚  â”‚
â”‚  â”‚  â€¢ Multi-Model (DeepSeek V3 / GPT-4o)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                   â”‚               â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚               â”‚
            â–¼                   â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Persistence       â”‚ â”‚ Integrations  â”‚ â”‚  Security Layer  â”‚
â”‚                      â”‚ â”‚               â”‚ â”‚                  â”‚
â”‚ â€¢ Supabase (Postgres)â”‚ â”‚ â€¢ Google Cal  â”‚ â”‚ â€¢ OAuth 2.0      â”‚
â”‚ â€¢ Memory Fallback    â”‚ â”‚ â€¢ Twilio SMS  â”‚ â”‚ â€¢ RLS Policies   â”‚
â”‚ â€¢ Session State      â”‚ â”‚ â€¢ Google Auth â”‚ â”‚ â€¢ Logic Guards   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### File Responsibility Map

| File | Responsibility |
|---|---|
| `lib/ai-agent.js` | Identity, System Prompt, and "Maya" personality configuration. |
| `lib/tools.js` | Executable tool definitions (`calculate_quote`, `get_availability`). |
| `lib/calendar.js` | Google Calendar API logic and Auth Token management. |
| `lib/supabase.js` | Data access layer with high-availability memory fallbacks. |
| `lib/twilio.js` | Dual-route lead alerts (Owner SMS + Client Confirmation). |
| `app/api/chat` | The core "ReAct" orchestrator â€” manages LLM tool-calling loops. |

---

## ğŸš€ Installation

### 1. Clone & Install

```bash
git clone https://github.com/Ismail-2001/Mobile-Detailing-AI-Agent.git
cd Mobile-Detailing-AI-Agent
npm install
```

### 2. Environment Configuration

Copy `.env.local.example` to `.env.local` and provide your keys:

```ini
# AI Engine
DEEPSEEK_API_KEY=your_key_here
OPENAI_API_KEY=your_key_here

# Persistence
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key
SUPABASE_SERVICE_ROLE_KEY=your_key

# Integrations
GOOGLE_CALENDAR_CLIENT_ID=your_id
GOOGLE_CALENDAR_CLIENT_SECRET=your_secret
TWILIO_ACCOUNT_SID=your_sid
TWILIO_AUTH_TOKEN=your_token
TWILIO_PHONE_NUMBER=your_number

# Business
BUSINESS_PHONE=+15551234567
BUSINESS_TIMEZONE=America/Chicago
```

### 3. Database Initialization

Execute the SQL script in `supabase/schema.sql` to create the following tables:
- `bookings`: Core appointment data.
- `usage_logs`: Tool execution and reasoning traces.
- `application_config`: Google Calendar OAuth tokens.
- `business_knowledge`: Dynamic pricing and policies.

### 4. Run Development

```bash
npm run dev
```

Visit `http://localhost:3000`. Use the dashboard password: `cleaner2026`.

---

## ğŸ›¡ï¸ Security & Scalability

### State Sovereignty
Session data is serialized on the server. The `sessionId` (generated in `ChatInterface.js`) ensures that even if a client refreshes, Maya maintains the context of the conversation using Supabase persistence.

### Tool Boundaries
Maya can **never** hallucinate pricing. The `executeTool` function in `lib/tools.js` pulls truth from `business_knowledge`. If the database is down, it fails-over to a localized `FALLBACK_KNOWLEDGE` object, ensuring the agent remains operational.

### Lead Integrity
The system triggers **Dual Alerts** via Twilio:
1. **Owner Alert**: A high-impact SMS containing all customer details, vehicle type, and price.
2. **Customer Confirmation**: A high-touch, concierge-style SMS confirming the time and service.

---

## ğŸ—ºï¸ Roadmap

### âœ… Phase 1: Foundation (Complete)
- [x] Multi-model Orchestration (DeepSeek/OpenAI)
- [x] ReAct Tool-Calling loop
- [x] Google Calendar Sync with Token Refresh persistence
- [x] Luxury Glassmorphism landing page
- [x] Zod validation for all business logic

### ğŸ”¨ Phase 2: Intelligence Expansion (Next)
- [ ] **Native Photo Storage**: Automatically upload customer photos to Supabase Storage for Maya to reference long-term.
- [ ] **Multi-Vehicle Support**: Ability to book multiple vehicles in a single session.
- [ ] **Payment Integration**: Stripe checkout session generation via an agent tool.

### ğŸ“‹ Phase 3: Enterprise Scale
- [ ] **Regional Routing**: Multi-location support for Austin, Dallas, and Houston.
- [ ] **Predictive Scheduling**: Analysis of traffic data to buffer appointment travel times.

---

## ğŸ¤ Contributing

We welcome contributions from Agentic Systems Engineers.
1. Fork the repo.
2. Create your feature branch (`git checkout -b feature/maya-stripe`).
3. Commit with [Conventional Commits](https://www.conventionalcommits.org/).
4. Open a Pull Request.

---

<div align="center">

**Built for the elite. Perfected by Maya.**

*If this platform helps your business grow, star â­ the repository.*

Built with â¤ï¸ by [Ismail Sajid](https://github.com/Ismail-2001)

</div>
